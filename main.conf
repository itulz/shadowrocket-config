# @iTulz - Shadowrocket configuration file
# https://github.com/itulz/shadowrocket-config

[General]

# Системные сетевые вызовы (например, push-уведомления, iOS системные сервисы)
bypass-system = true

# Отключение поддержки IPv6.
ipv6 = false

# Отдавать приоритет разрешению DNS-записей AAAA (IPv6) над A (IPv4). 
prefer-ipv6 = false

# Если true, при DNS-запросах возвращаются приватные IP адреса (например, из диапазона 192.168.x.x). При false Shadowrocket будет считать домен "захваченным" и принудительно отправит трафик через прокси, что может нарушать локальную сеть. Обычно лучше оставлять true.
private-ip-answer = true

# Управляет тем, будет ли DNS разрешение происходить напрямую через системный DNS, а не через прокси или настроенный DoH/DoT. Если точно нужен перехват DNS — оставлять false; для обхода по системному DNS — true.
dns-direct-system = false

# Если DNS-запросы через основной DNS (например DoH) неудачны, будет ли пробоваться системный DNS. При false — отказ DNS через fallback. Можно включить, чтобы повысить стабильность разрешения.
dns-fallback-system = false

# Если прямое разрешение DNS не работает, использовать прокси-сервер для DNS-запросов
dns-direct-fallback-proxy = true

# Перезаписывает системный DNS на указанные DoH-серверы. Google DNS — стандартный, Adguard предлагает блокировку рекламы.
dns-server = https://dns.google/dns-query, https://cloudflare-dns.com/dns-query

# При сбое основного django Server — fallback на системный DNS.
fallback-dns-server = system

# Перехватывает DNS-запросы некоторых сервисов (Например, Netflix) на UDP/TCP порт 53 и направляет через программу
hijack-dns = :53

# Адреса/домены, обходящие прокси, но проходящие через туннель (TUN-интерфейс)
skip-proxy = 192.168.0.0/16,10.0.0.0/8,172.16.0.0/12,localhost,*.local,captive.apple.com

# IP-диапазоны, исключённые из туннеля (TUN-интерфейс). Например, UDP/DNS для стабильности сетевых сервисов
tun-excluded-routes = 10.0.0.0/8,100.64.0.0/10,127.0.0.0/8,169.254.0.0/16,172.16.0.0/12,192.0.0.0/24,192.0.2.0/24,192.88.99.0/24,192.168.0.0/16,198.51.100.0/24,203.0.113.0/24,224.0.0.0/4,255.255.255.255/32,239.255.255.250/32

# Позволяет SR возвращать настоящий IP вместо fake-IP для перечисленных доменов.
# Это важно для служб, где нужно "реальное" соединение без проксирования (например, NTP, Cloudflare client).
# Позволяет сократить проблемы с задержками, ошибками соединения и энергопотреблением.
always-real-ip = *

# Включает автоматический ответ на ping (ICMP Echo Request) от имени TUN-интерфейса. 
# Удобно для сетевой диагностики, но может приводить к созданию fake-IP маппинга, что увеличивает расход ресурсов и может в итоге разряжать аккумулятор.
# Если цель — минимизация fake-IP и энергозатрат, ставить false.
icmp-auto-reply = false

# Управляет, активна ли политика REJECT для URL-перезаписи вне режима конфигурации. 
# При true REJECT работает постоянно, что может «жёстко» блокировать трафик. 
always-reject-url-rewrite = false

# Как поступать с UDP-трафиком, если политика узла не поддерживает UDP-перенаправление: отбрасывать (REJECT) или направлять напрямую (DIRECT). Выбор зависит от желаемого поведения и возможности узла.
udp-policy-not-supported-behaviour = REJECT

# URL-адрес обновления файла конфигурации
update-url = https://raw.githubusercontent.com/itulz/shadowrocket-config/refs/heads/main/main.conf

# Выборочные правила маршрутизации
# REJECT returns HTTP status code 404 with no content. 
# REJECT-DICT returns HTTP status code 200 with content of empty js... 
# REJECT-ARRAY returns HTTP status code 200 with content of empty js... 
# REJECT-200 returns HTTP status code 200 with no content. 
# REJECT-IMG returns HTTP status code 200 with content of 1px gif. 
# REJECT-TINYGIF returns HTTP status code 200 with content of 1px gif. 
# REJECT-DROP Drop IP Packet REJECT-NO-DROP returns ICMP port unreachable. 
# REJECT-VIDEO returns HTTP status code 200 with content of blank MP4.
[Rule]
RULE-SET,https://raw.githubusercontent.com/itulz/shadowrocket-config/refs/heads/main/rules/domains_external.list,PROXY
RULE-SET,https://raw.githubusercontent.com/itulz/shadowrocket-config/refs/heads/main/rules/domains_openai.list,PROXY
RULE-SET,https://raw.githubusercontent.com/itulz/shadowrocket-config/refs/heads/main/rules/domains_tiktok.list,PROXY
RULE-SET,https://raw.githubusercontent.com/itulz/shadowrocket-config/refs/heads/main/rules/domains_instagram.list,PROXY
RULE-SET,https://raw.githubusercontent.com/itulz/shadowrocket-config/refs/heads/main/rules/domains_youtube.list,PROXY
RULE-SET,https://raw.githubusercontent.com/itulz/shadowrocket-config/refs/heads/main/rules/domains_anthropic.list,PROXY
RULE-SET,https://raw.githubusercontent.com/itulz/shadowrocket-config/refs/heads/main/rules/domains_google-deepmind.list,PROXY
RULE-SET,https://raw.githubusercontent.com/itulz/shadowrocket-config/refs/heads/main/rules/domains_agilebits.list,PROXY
RULE-SET,https://raw.githubusercontent.com/itulz/shadowrocket-config/refs/heads/main/rules/domains_telegram.list,PROXY
RULE-SET,https://raw.githubusercontent.com/itulz/shadowrocket-config/refs/heads/main/rules/domains_blocked.list,REJECT-200
FINAL,DIRECT